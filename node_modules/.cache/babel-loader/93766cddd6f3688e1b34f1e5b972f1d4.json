{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Diogo Eduardo\\\\Desktop\\\\deliverynowhats\\\\src\\\\GlobalContext.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport firebase from './Components/Firebase/firebase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const GlobalContext = /*#__PURE__*/React.createContext();\nexport const GlobalStorage = ({\n  children\n}) => {\n  _s();\n\n  const [data, setData] = React.useState([]);\n  const [listProducts, setListProducts] = React.useState([]);\n  const [openCart, setOpenCart] = React.useState(false);\n  const [openObs, setOpenObs] = React.useState(false);\n  const [openAdicional, setOpenAdicional] = React.useState(false);\n  const [obs, setObs] = React.useState(null);\n  const [adicional, setAdicional] = React.useState([]);\n  const [adicionalPrice, setAdicionalPrice] = React.useState([]);\n  const [idObs, setIdObs] = React.useState(null);\n  const [idAdicional, setIdAdicional] = React.useState(null);\n  const [cart, setCart] = React.useState([]);\n  const [total, setTotal] = React.useState(0);\n  const [user, setUser] = React.useState(null);\n  const [typeBuy, setTypeBuy] = React.useState('');\n  const [cep, setCep] = React.useState('');\n  const [number, setNumber] = React.useState('');\n  const [complement, setComplement] = React.useState('');\n  const [typePayment, setTypePayment] = React.useState('');\n  const [address, setAddress] = React.useState(null);\n  const [order, setOrder] = React.useState('');\n  const [categoria, setCategoria] = React.useState([]);\n  const [idNum, setIdNum] = React.useState(0);\n  const [empresa, setEmpresa] = React.useState([]);\n  const [Loja, setLoja] = React.useState();\n\n  function addCart(item) {\n    item.id = idNum + 1;\n    item.quantity = 1;\n    item.currentPrice = item.price;\n    item.isSelected = true;\n    setCart(oldArray => [...oldArray, item]);\n  } // add note to cart item\n\n\n  function addObs(id) {\n    let indexItem = cart.map(e => e.id).indexOf(id);\n    let updatedCart = [...cart];\n    updatedCart[indexItem].obs = obs;\n    setCart(updatedCart);\n  }\n\n  function addAdicional(id) {\n    let indexItem = cart.map(e => e.id).indexOf(id);\n    let updatedCart = [...cart];\n    updatedCart[indexItem].adicional = adicional + ' ';\n    updatedCart[indexItem].priceAdicional = adicionalPrice;\n    setAdicional(updatedCart);\n    console.log(cart);\n  }\n\n  function incrementItem(item) {\n    let indexItem = cart.map(e => e.id).indexOf(item.id);\n    let updatedCart = [...cart];\n    updatedCart[indexItem].quantity = updatedCart[indexItem].quantity + 1;\n    updatedCart[indexItem].currentPrice = updatedCart[indexItem].currentPrice + updatedCart[indexItem].price;\n    setCart(updatedCart);\n  }\n\n  function decrementItem(item) {\n    let indexItem = cart.map(e => e.id).indexOf(item.id);\n    let updatedCart = [...cart];\n    updatedCart[indexItem].quantity = updatedCart[indexItem].quantity - 1;\n    updatedCart[indexItem].currentPrice = updatedCart[indexItem].currentPrice - updatedCart[indexItem].price;\n\n    if (updatedCart[indexItem].quantity === 0) {\n      updatedCart[indexItem].isSelected = false;\n      updatedCart.splice(indexItem, 1);\n      setCart(updatedCart);\n    }\n\n    setCart(updatedCart);\n  }\n\n  const getProducts = async category => {\n    const firestoreRef = firebase.firestore().collection('Loja').doc(Loja).collection('Produtos').doc(category).collection('Itens');\n    const unsub = firestoreRef.onSnapshot(getCollection);\n    return () => {\n      unsub();\n    };\n  };\n\n  const getEmpresas = loja => {\n    firebase.firestore().collection('Loja').doc(loja).collection('Empresa').get().then(querySnapshot => {\n      const array = [];\n      querySnapshot.forEach(doc => {\n        const {\n          name,\n          cel,\n          img,\n          status\n        } = doc.data();\n        array.push({\n          id: doc.id,\n          name,\n          cel,\n          img,\n          status\n        });\n        const novo = array.map(item => ({\n          name: item.name,\n          cel: item.cel,\n          img: item.img,\n          status: item.status\n        }));\n        setEmpresa(novo);\n      });\n    });\n    firebase.firestore().collection('Loja').doc(loja).collection('Produtos').get().then(querySnapshot => {\n      const array = [];\n      querySnapshot.forEach(doc => {\n        array.push({\n          name: doc.id\n        });\n        const novo = array.map(item => ({\n          name: item.name\n        }));\n        setCategoria(novo);\n      });\n    });\n    setLoja(loja);\n    getProducts();\n  };\n\n  function getCollection(querySnapshot) {\n    const array = [];\n    querySnapshot.forEach(res => {\n      const {\n        title,\n        price,\n        img,\n        offer,\n        description,\n        id\n      } = res.data();\n      array.push({\n        doc: res.id,\n        id,\n        title,\n        price,\n        description,\n        img,\n        offer\n      });\n      const novo = array.map(item => ({\n        id: item.id,\n        title: item.title,\n        img: item.img,\n        price: item.price,\n        description: item.description,\n        offer: item.offer\n      }));\n      setData(novo);\n    });\n  }\n\n  async function getCep(cep) {\n    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);\n    const json = await response.json();\n    setAddress({\n      rua: json.logradouro,\n      cidade: json.localidade,\n      bairro: json.bairro,\n      uf: json.uf,\n      cep: json.cep\n    });\n  } // wait for the CEP to be filled in with 8 digits to make the request\n\n\n  React.useEffect(() => {\n    if (cep.length >= 8) {\n      getCep(cep);\n    }\n  }, [cep]); // watch the cart changes to calculate the total price.\n\n  React.useEffect(() => {\n    if (cart.length > 0) {\n      const prices = cart.map(item => item.currentPrice);\n      setTotal(prices.reduce((a, b) => a + b));\n      const numero = cart.length;\n      setIdNum(numero + 1);\n    }\n  }, [cart]); // save the address in localStorage after finalizing the order\n\n  React.useEffect(() => {\n    if (typeBuy === 'delivery') {\n      window.localStorage.setItem('address', JSON.stringify(order.address));\n    }\n  }, [order]);\n  React.useEffect(() => {\n    setListProducts(data);\n  }, [data]); // loads product list and default localStorage address\n\n  React.useEffect(() => {\n    async function loadData() {// const response = await fetch(\n      //   'https://my-json-server.typicode.com/danielmafra/api/Bebidas'\n      // )\n      // const json = await response.json()\n      // setData(json)\n      // getEmpresas()\n    }\n\n    loadData();\n    const addressDefault = window.localStorage.getItem('address');\n\n    if (addressDefault !== '' && addressDefault !== null && addressDefault !== undefined) {\n      setUser(JSON.parse(addressDefault));\n    } else {\n      setUser(null);\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(GlobalContext.Provider, {\n    value: {\n      getProducts,\n      listProducts,\n      categoria,\n      addCart,\n      cart,\n      total,\n      incrementItem,\n      decrementItem,\n      user,\n      setUser,\n      typeBuy,\n      setTypeBuy,\n      cep,\n      setCep,\n      number,\n      setNumber,\n      complement,\n      setComplement,\n      typePayment,\n      setTypePayment,\n      address,\n      setAddress,\n      order,\n      setOrder,\n      openCart,\n      setOpenCart,\n      openAdicional,\n      setOpenAdicional,\n      openObs,\n      setOpenObs,\n      idObs,\n      setIdObs,\n      adicional,\n      idAdicional,\n      setIdAdicional,\n      obs,\n      setObs,\n      setAdicional,\n      addAdicional,\n      addObs,\n      empresa,\n      getEmpresas,\n      setAdicionalPrice,\n      adicionalPrice\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 237,\n    columnNumber: 9\n  }, this);\n};\n\n_s(GlobalStorage, \"FLez64ESLdEHpfH78RGH0wWXZYY=\");\n\n_c = GlobalStorage;\n\nvar _c;\n\n$RefreshReg$(_c, \"GlobalStorage\");","map":{"version":3,"sources":["C:/Users/Diogo Eduardo/Desktop/deliverynowhats/src/GlobalContext.js"],"names":["React","firebase","GlobalContext","createContext","GlobalStorage","children","data","setData","useState","listProducts","setListProducts","openCart","setOpenCart","openObs","setOpenObs","openAdicional","setOpenAdicional","obs","setObs","adicional","setAdicional","adicionalPrice","setAdicionalPrice","idObs","setIdObs","idAdicional","setIdAdicional","cart","setCart","total","setTotal","user","setUser","typeBuy","setTypeBuy","cep","setCep","number","setNumber","complement","setComplement","typePayment","setTypePayment","address","setAddress","order","setOrder","categoria","setCategoria","idNum","setIdNum","empresa","setEmpresa","Loja","setLoja","addCart","item","id","quantity","currentPrice","price","isSelected","oldArray","addObs","indexItem","map","e","indexOf","updatedCart","addAdicional","priceAdicional","console","log","incrementItem","decrementItem","splice","getProducts","category","firestoreRef","firestore","collection","doc","unsub","onSnapshot","getCollection","getEmpresas","loja","get","then","querySnapshot","array","forEach","name","cel","img","status","push","novo","res","title","offer","description","getCep","response","fetch","json","rua","logradouro","cidade","localidade","bairro","uf","useEffect","length","prices","reduce","a","b","numero","window","localStorage","setItem","JSON","stringify","loadData","addressDefault","getItem","undefined","parse"],"mappings":"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","sourcesContent":["import React from 'react';\nimport firebase from './Components/Firebase/firebase';\nexport const GlobalContext = React.createContext();\n\nexport const GlobalStorage = ({ children }) => {\n    const [data, setData] = React.useState([]);\n    const [listProducts, setListProducts] = React.useState([]);\n    const [openCart, setOpenCart] = React.useState(false);\n    const [openObs, setOpenObs] = React.useState(false);\n    const [openAdicional, setOpenAdicional] = React.useState(false);\n    const [obs, setObs] = React.useState(null);\n    const [adicional, setAdicional] = React.useState([]);\n    const [adicionalPrice, setAdicionalPrice] = React.useState([]);\n    const [idObs, setIdObs] = React.useState(null);\n    const [idAdicional, setIdAdicional] = React.useState(null);\n    const [cart, setCart] = React.useState([]);\n    const [total, setTotal] = React.useState(0);\n    const [user, setUser] = React.useState(null);\n    const [typeBuy, setTypeBuy] = React.useState('');\n    const [cep, setCep] = React.useState('');\n    const [number, setNumber] = React.useState('');\n    const [complement, setComplement] = React.useState('');\n    const [typePayment, setTypePayment] = React.useState('');\n    const [address, setAddress] = React.useState(null);\n    const [order, setOrder] = React.useState('');\n    const [categoria, setCategoria] = React.useState([]);\n    const [idNum, setIdNum] = React.useState(0);\n    const [empresa, setEmpresa] = React.useState([]);\n    const [Loja, setLoja] = React.useState();\n\n    function addCart(item) {\n        item.id = idNum + 1;\n        item.quantity = 1;\n        item.currentPrice = item.price;\n        item.isSelected = true;\n        setCart((oldArray) => [...oldArray, item]);\n    }\n\n    // add note to cart item\n    function addObs(id) {\n        let indexItem = cart.map((e) => e.id).indexOf(id);\n        let updatedCart = [...cart];\n        updatedCart[indexItem].obs = obs;\n        setCart(updatedCart);\n    }\n\n    function addAdicional(id) {\n        let indexItem = cart.map((e) => e.id).indexOf(id);\n        let updatedCart = [...cart];\n        updatedCart[indexItem].adicional = adicional + ' ';\n        updatedCart[indexItem].priceAdicional = adicionalPrice;\n\n        setAdicional(updatedCart);\n\n        console.log(cart);\n    }\n\n    function incrementItem(item) {\n        let indexItem = cart.map((e) => e.id).indexOf(item.id);\n        let updatedCart = [...cart];\n        updatedCart[indexItem].quantity = updatedCart[indexItem].quantity + 1;\n        updatedCart[indexItem].currentPrice =\n            updatedCart[indexItem].currentPrice + updatedCart[indexItem].price;\n        setCart(updatedCart);\n    }\n\n    function decrementItem(item) {\n        let indexItem = cart.map((e) => e.id).indexOf(item.id);\n        let updatedCart = [...cart];\n        updatedCart[indexItem].quantity = updatedCart[indexItem].quantity - 1;\n        updatedCart[indexItem].currentPrice =\n            updatedCart[indexItem].currentPrice - updatedCart[indexItem].price;\n        if (updatedCart[indexItem].quantity === 0) {\n            updatedCart[indexItem].isSelected = false;\n            updatedCart.splice(indexItem, 1);\n            setCart(updatedCart);\n        }\n        setCart(updatedCart);\n    }\n\n    const getProducts = async (category) => {\n        const firestoreRef = firebase\n            .firestore()\n            .collection('Loja')\n            .doc(Loja)\n            .collection('Produtos')\n            .doc(category)\n            .collection('Itens');\n        const unsub = firestoreRef.onSnapshot(getCollection);\n        return () => {\n            unsub();\n        };\n    };\n\n    const getEmpresas = (loja) => {\n        firebase\n            .firestore()\n            .collection('Loja')\n            .doc(loja)\n            .collection('Empresa')\n            .get()\n            .then((querySnapshot) => {\n                const array = [];\n                querySnapshot.forEach((doc) => {\n                    const { name, cel, img, status } = doc.data();\n                    array.push({\n                        id: doc.id,\n                        name,\n                        cel,\n                        img,\n                        status,\n                    });\n                    const novo = array.map((item) => ({\n                        name: item.name,\n                        cel: item.cel,\n                        img: item.img,\n                        status: item.status,\n                    }));\n                    setEmpresa(novo);\n                });\n            });\n\n        firebase\n            .firestore()\n            .collection('Loja')\n            .doc(loja)\n            .collection('Produtos')\n            .get()\n            .then((querySnapshot) => {\n                const array = [];\n                querySnapshot.forEach((doc) => {\n                    array.push({\n                        name: doc.id,\n                    });\n                    const novo = array.map((item) => ({\n                        name: item.name,\n                    }));\n                    setCategoria(novo);\n                });\n            });\n        setLoja(loja);\n        getProducts();\n    };\n\n    function getCollection(querySnapshot) {\n        const array = [];\n        querySnapshot.forEach((res) => {\n            const { title, price, img, offer, description, id } = res.data();\n            array.push({\n                doc: res.id,\n                id,\n                title,\n                price,\n                description,\n                img,\n                offer,\n            });\n            const novo = array.map((item) => ({\n                id: item.id,\n                title: item.title,\n                img: item.img,\n                price: item.price,\n                description: item.description,\n                offer: item.offer,\n            }));\n            setData(novo);\n        });\n    }\n\n    async function getCep(cep) {\n        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);\n        const json = await response.json();\n        setAddress({\n            rua: json.logradouro,\n            cidade: json.localidade,\n            bairro: json.bairro,\n            uf: json.uf,\n            cep: json.cep,\n        });\n    }\n\n    // wait for the CEP to be filled in with 8 digits to make the request\n    React.useEffect(() => {\n        if (cep.length >= 8) {\n            getCep(cep);\n        }\n    }, [cep]);\n\n    // watch the cart changes to calculate the total price.\n    React.useEffect(() => {\n        if (cart.length > 0) {\n            const prices = cart.map((item) => item.currentPrice);\n            setTotal(prices.reduce((a, b) => a + b));\n            const numero = cart.length;\n            setIdNum(numero + 1);\n        }\n    }, [cart]);\n\n    // save the address in localStorage after finalizing the order\n    React.useEffect(() => {\n        if (typeBuy === 'delivery') {\n            window.localStorage.setItem(\n                'address',\n                JSON.stringify(order.address)\n            );\n        }\n    }, [order]);\n\n    React.useEffect(() => {\n        setListProducts(data);\n    }, [data]);\n\n    // loads product list and default localStorage address\n    React.useEffect(() => {\n        async function loadData() {\n            // const response = await fetch(\n            //   'https://my-json-server.typicode.com/danielmafra/api/Bebidas'\n            // )\n            // const json = await response.json()\n            // setData(json)\n            // getEmpresas()\n        }\n        loadData();\n        const addressDefault = window.localStorage.getItem('address');\n        if (\n            addressDefault !== '' &&\n            addressDefault !== null &&\n            addressDefault !== undefined\n        ) {\n            setUser(JSON.parse(addressDefault));\n        } else {\n            setUser(null);\n        }\n    }, []);\n\n    return (\n        <GlobalContext.Provider\n            value={{\n                getProducts,\n                listProducts,\n                categoria,\n                addCart,\n                cart,\n                total,\n                incrementItem,\n                decrementItem,\n                user,\n                setUser,\n                typeBuy,\n                setTypeBuy,\n                cep,\n                setCep,\n                number,\n                setNumber,\n                complement,\n                setComplement,\n                typePayment,\n                setTypePayment,\n                address,\n                setAddress,\n                order,\n                setOrder,\n                openCart,\n                setOpenCart,\n                openAdicional,\n                setOpenAdicional,\n                openObs,\n                setOpenObs,\n                idObs,\n                setIdObs,\n                adicional,\n                idAdicional,\n                setIdAdicional,\n                obs,\n                setObs,\n                setAdicional,\n                addAdicional,\n                addObs,\n                empresa,\n                getEmpresas,\n                setAdicionalPrice,\n                adicionalPrice,\n            }}\n        >\n            {children}\n        </GlobalContext.Provider>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}